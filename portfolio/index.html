<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .project-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .source-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 1rem;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Portfolio Viewer</h1>
            <p class="text-gray-600">Viewing projects from multiple sources</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-container">
            <!-- Projects will be loaded here by JavaScript -->
            <div class="text-center py-8" id="loading">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500 mb-2"></div>
                <p>Loading projects...</p>
            </div>
        </div>

        <div class="mt-12 text-center text-sm text-gray-500" id="last-updated">
            Last updated: <span id="update-time">Just now</span>
        </div>
    </div>

    <script>
        // Convert repository object to array of projects
        function repositoriesToProjects(repositories) {
            if (!repositories) return [];
            if (Array.isArray(repositories)) return repositories; // Already an array
            return Object.values(repositories).map(repo => ({
                name: repo.name,
                full_name: repo.full_name || `${repo.owner?.login || 'unknown'}/${repo.name}`,
                description: repo.description || 'No description',
                url: repo.html_url || repo.url || '#',
                language: repo.language || 'Unknown',
                stars: repo.stargazers_count || 0,
                forks: repo.forks_count || 0,
                updated_at: repo.updated_at || repo.pushed_at || '',
                created_at: repo.created_at || '',
                source: repo.source || 'unknown'
            }));
        }

        // Fetch and display projects from all JSON files
        async function loadPortfolio() {
            const container = document.getElementById('projects-container');
            const loading = document.getElementById('loading');
            const updateTimeElement = document.getElementById('update-time');
            
            try {
                // List of portfolio JSON files to load
                const portfolioFiles = [
                    'portfolio.json',
                    'portfolio_github.json',
                    'portfolio_npm.json',
                    'portfolio_huggingface.json'
                ];
                
                const allProjects = [];
                let lastUpdated = null;
                
                // Load each portfolio file
                for (const file of portfolioFiles) {
                    try {
                        console.log(`Loading ${file}...`);
                        const response = await fetch(file);
                        if (!response.ok) {
                            console.warn(`Failed to load ${file}:`, response.statusText);
                            continue;
                        }
                        const data = await response.json();
                        console.log(`Loaded ${file} with data:`, data);
                        
                        // Update last_updated from any file that has it
                        if (data.last_updated) {
                            const fileUpdateTime = new Date(data.last_updated);
                            if (!lastUpdated || fileUpdateTime > new Date(lastUpdated)) {
                                lastUpdated = data.last_updated;
                                updateTimeElement.textContent = new Date(lastUpdated).toLocaleString();
                            }
                        }
                        
                        // Handle different portfolio file formats
                        let projects = [];
                        if (data.projects && Array.isArray(data.projects)) {
                            projects = data.projects;
                            console.log(`Found ${projects.length} projects in data.projects`);
                        } else if (data.repositories && typeof data.repositories === 'object') {
                            // Handle the case where projects are in repositories object
                            projects = Object.values(data.repositories);
                            console.log(`Found ${projects.length} projects in data.repositories`);
                        } else if (Array.isArray(data)) {
                            projects = data;
                            console.log(`Found ${projects.length} projects in root array`);
                        } else if (typeof data === 'object') {
                            projects = Object.values(data);
                            console.log(`Found ${projects.length} projects in root object`);
                        }
                        
                        if (projects && projects.length > 0) {
                            // Add source information
                            const source = file.replace('portfolio_', '').replace('.json', '') || 'portfolio';
                            const processedProjects = projects.map(project => ({
                                ...project,
                                _source: project.source || source,
                                // Ensure required fields exist
                                name: project.name || (typeof project.full_name === 'string' ? project.full_name.split('/').pop() : 'Untitled Project'),
                                full_name: project.full_name || `unknown/${project.name || 'project'}`,
                                description: project.description || 'No description available',
                                url: project.html_url || project.url || project.homepage || '#',
                                language: project.language || 'Unknown',
                                stars: project.stargazers_count || project.stars || 0,
                                updated_at: project.updated_at || project.pushed_at || project.created_at || new Date().toISOString()
                            }));
                            
                            allProjects.push(...processedProjects);
                        }
                    } catch (error) {
                        console.error(`Error loading ${file}:`, error);
                    }
                }
                
                // Remove duplicates based on URL or full_name
                const uniqueProjects = [];
                const seen = new Set();
                
                for (const project of allProjects) {
                    const key = project.url || project.full_name || project.name;
                    if (key && !seen.has(key)) {
                        seen.add(key);
                        uniqueProjects.push(project);
                    }
                }
                
                // Sort by update date (newest first)
                uniqueProjects.sort((a, b) => {
                    const dateA = new Date(a.updated_at || a.pushed_at || a.created_at || 0);
                    const dateB = new Date(b.updated_at || b.pushed_at || b.created_at || 0);
                    return dateB - dateA;
                });
                
                // Update last updated time
                if (lastUpdated) {
                    updateTimeElement.textContent = new Date(lastUpdated).toLocaleString();
                } else {
                    updateTimeElement.textContent = 'Unknown';
                }
                
                // Display the projects
                displayProjects(uniqueProjects);
                
            } catch (error) {
                console.error('Error loading portfolio:', error);
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="text-red-500 mb-2">Error loading portfolio data</div>
                        <pre class="text-xs text-gray-500 overflow-auto max-h-40">${error.message}</pre>
                    </div>
                `;
            } finally {
                loading.style.display = 'none';
            }
        }

        // Display projects in the UI
        function displayProjects(projects) {
            const container = document.getElementById('projects-container');
            
            if (!projects || projects.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <p class="text-gray-500">No projects found.</p>
                    </div>
                `;
                return;
            }

            // Create project cards
            const projectCards = projects.map(project => {
                const title = project.name || 'Untitled Project';
                const description = project.description || 'No description available';
                const url = project.html_url || project.url || project.homepage || '#';
                const source = project._source || 'unknown';
                const language = project.language || 'Unknown';
                const stars = project.stars || project.stargazers_count || 0;
                const updatedAt = project.updated_at || project.pushed_at || project.created_at;
                const updatedDate = updatedAt ? new Date(updatedAt).toLocaleDateString() : 'Unknown';
                
                // Create source badge with icon
                const getSourceIcon = (src) => {
                    const icons = {
                        'github': 'github',
                        'gitlab': 'gitlab',
                        'npm': 'npm',
                        'pypi': 'python',
                        'docker': 'docker',
                        'huggingface': 'robot'
                    };
                    return icons[src] || 'code';
                };
                
                // Create language color
                const getLanguageColor = (lang) => {
                    const colors = {
                        'JavaScript': 'bg-yellow-400',
                        'TypeScript': 'bg-blue-600',
                        'Python': 'bg-blue-400',
                        'HTML': 'bg-orange-500',
                        'CSS': 'bg-purple-500',
                        'Shell': 'bg-gray-400',
                        'Dockerfile': 'bg-blue-300',
                        'PHP': 'bg-indigo-500',
                        'Java': 'bg-red-500',
                        'C++': 'bg-pink-500',
                        'C#': 'bg-green-600',
                        'Go': 'bg-cyan-500',
                        'Rust': 'bg-orange-700',
                        'Ruby': 'bg-red-600',
                        'Swift': 'bg-orange-400'
                    };
                    return colors[lang] || 'bg-gray-500';
                };
                
                // Format date
                let dateStr = '';
                if (updatedAt) {
                    const date = new Date(updatedAt);
                    dateStr = date.toLocaleDateString();
                }
                
                // Get source icon class
                const sourceIcon = getSourceIcon(source.toLowerCase());
                
                // Create project card HTML
                return `
                    <div class="project-card bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
                        <div class="p-5">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-lg font-bold text-gray-900 truncate">
                                        <a href="${url}" target="_blank" rel="noopener noreferrer" class="hover:text-blue-600 transition-colors flex items-center">
                                            <i class="fab fa-${sourceIcon} mr-2 text-gray-400"></i>
                                            <span class="truncate">${title}</span>
                                        </a>
                                    </h3>
                                    <div class="text-xs text-gray-500 mt-1">
                                        <span>${source}</span>
                                        <span class="mx-1">•</span>
                                        <span>Updated ${updatedDate}</span>
                                    </div>
                                </div>
                                
                                ${stars > 0 ? `
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-50 text-yellow-700 border border-yellow-200">
                                        <i class="fas fa-star mr-1"></i>
                                        ${stars.toLocaleString()}
                                    </span>
                                ` : ''}
                            </div>
                            
                            <p class="text-gray-600 text-sm mb-4 line-clamp-3">${description}</p>
                            
                            <div class="flex flex-wrap items-center justify-between mt-4 pt-3 border-t border-gray-100">
                                ${language ? `
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getLanguageColor(language)} text-white">
                                        ${language}
                                    </span>
                                ` : '<div></div>'}
                                
                                <a href="${url}" target="_blank" rel="noopener noreferrer" class="text-xs font-medium text-blue-600 hover:text-blue-800 transition-colors inline-flex items-center">
                                    View Project
                                    <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Display the projects
            displayProjects(uniqueProjects);
            
        } catch (error) {
            console.error('Error loading portfolio:', error);
            container.innerHTML = `
                <div class="col-span-full text-center py-8">
                    <div class="text-red-500 mb-2">Error loading portfolio data</div>
                    <pre class="text-xs text-gray-500 overflow-auto max-h-40">${error.message}</pre>
                </div>
            `;
        } finally {
            loading.style.display = 'none';
        }
    }

    // Display projects in the UI
    function displayProjects(projects) {
        const container = document.getElementById('projects-container');
        
        if (!projects || projects.length === 0) {
            container.innerHTML = `
                <div class="col-span-full text-center py-8">
                    <p class="text-gray-500">No projects found.</p>
                </div>
            `;
            return;
        }

        // Create project cards
        const projectCards = projects.map(project => {
            const title = project.name || 'Untitled Project';
            const description = project.description || 'No description available';
            const url = project.html_url || project.url || project.homepage || '#';
            const source = project._source || 'unknown';
            const language = project.language || 'Unknown';
            const stars = project.stars || project.stargazers_count || 0;
            const updatedAt = project.updated_at || project.pushed_at || project.created_at;
            const updatedDate = updatedAt ? new Date(updatedAt).toLocaleDateString() : 'Unknown';
            
            // Create source badge with icon
            const getSourceIcon = (src) => {
                const icons = {
                    'github': 'github',
                    'gitlab': 'gitlab',
                    'npm': 'npm',
                    'pypi': 'python',
                    'docker': 'docker',
                    'huggingface': 'robot'
                };
                return icons[src] || 'code';
            };
            
            // Create language color
            const getLanguageColor = (lang) => {
                const colors = {
                    'JavaScript': 'bg-yellow-400',
                    'TypeScript': 'bg-blue-600',
                    'Python': 'bg-blue-400',
                    'HTML': 'bg-orange-500',
                    'CSS': 'bg-purple-500',
                    'Shell': 'bg-gray-400',
                    'Dockerfile': 'bg-blue-300',
                    'PHP': 'bg-indigo-500',
                    'Java': 'bg-red-500',
                    'C++': 'bg-pink-500',
                    'C#': 'bg-green-600',
                    'Go': 'bg-cyan-500',
                    'Rust': 'bg-orange-700',
                    'Ruby': 'bg-red-600',
                    'Swift': 'bg-orange-400'
                };
                return colors[lang] || 'bg-gray-500';
            };
            
            // Format date
            let dateStr = '';
            if (updatedAt) {
                const date = new Date(updatedAt);
                dateStr = date.toLocaleDateString();
            }
            
            // Get source icon class
            const sourceIcon = getSourceIcon(source.toLowerCase());
            
            // Create project card HTML
            return `
                <div class="project-card bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-bold text-gray-900 truncate">
                                    <a href="${url}" target="_blank" rel="noopener noreferrer" class="hover:text-blue-600 transition-colors flex items-center">
                                        <i class="fab fa-${sourceIcon} mr-2 text-gray-400"></i>
                                        <span class="truncate">${title}</span>
                                    </a>
                                </h3>
                                <div class="text-xs text-gray-500 mt-1">
                                    <span>${source}</span>
                                    <span class="mx-1">•</span>
                                    <span>Updated ${updatedDate}</span>
                                </div>
                            </div>
                            
                            ${stars > 0 ? `
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-50 text-yellow-700 border border-yellow-200">
                                    <i class="fas fa-star mr-1"></i>
                                    ${stars.toLocaleString()}
                                </span>
                            ` : ''}
                        </div>
                        
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3">${description}</p>
                        
                        <div class="flex flex-wrap items-center justify-between mt-4 pt-3 border-t border-gray-100">
                            ${language ? `
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getLanguageColor(language)} text-white">
                                    ${language}
                                </span>
                            ` : '<div></div>'}
                            
                            <a href="${url}" target="_blank" rel="noopener noreferrer" class="text-xs font-medium text-blue-600 hover:text-blue-800 transition-colors inline-flex items-center">
                                View Project
                                <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }).join('');

        container.innerHTML = projectCards;
    }

    // Load portfolio when page loads
    document.addEventListener('DOMContentLoaded', loadPortfolio);
</script>
</body>
</html>
